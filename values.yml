image:
  registry: ghcr.io
  repository: bgshacklett/swimctl
  tag: latest


resources:
  limits:
    smarter-devices/i2c-1: 1
    smarter-devices/i2c-20: 1
    smarter-devices/i2c-21: 1
  requests:
    smarter-devices/i2c-1: 1
    smarter-devices/i2c-20: 1
    smarter-devices/i2c-21: 1


podSecurityContext:
  runAsUser: 1000 # UID
  runAsGroup: 1000 # GID
  fsGroup: 1000 # GID for volume permission
  supplementalGroups:
    - 998


deploymentStrategy: Recreate


env:
  - name: NODE_RED_ENABLE_PROJECTS
    value: 'true'

  - name: NODE_RED_ACTIVE_PROJECT
    value: swimctl-flows


ingress:
  enabled: true
  hosts:
    - host: swimctl.local
      paths:
        - path: /
          pathType: ImplementationSpecific


settings:
  name: settings
  configMapName: node-red-settings


extraVolumeMounts:
  - name: node-red-projects-settings
    mountPath: /data/.config.projects.json
    subPath: .config.projects.json


extraVolumes:
  - name: node-red-projects-settings
    configMap:
      name: node-red-projects-settings


initContainers:
  - name: clone-repo
    image: alpine/git # or any image that has git
    env:
      - name: GIT_REPO
        value: "https://github.com/bgshacklett/swimctl-flows.git"
      - name: GIT_VERSION
        value: "main"
    securityContext:
      runAsUser: 10003
      runAsGroup: 10003
    command:
    - /bin/sh
    - -c
    - |
      rm -rf /data/projects/* &&
      git clone $(GIT_REPO) /data/projects/swimctl-flows &&
      cd /data/projects/swimctl-flows &&
      git checkout $(GIT_VERSION)
    volumeMounts:
    - mountPath: /data
      name: data
